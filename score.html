<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TOP25</title>
<link href="https://fonts.googleapis.com/css2?family=Mitr:wght@400;600;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg1:#031c47;
  --bg2:#072f73;
  --highlight:#ffd400;
  --text:#ffffff;
  --shadow:rgba(0,0,0,0.25);
}
*{box-sizing:border-box;margin:0;padding:0;}
body{
  font-family:"Mitr",sans-serif;
  color:var(--text);
  background:linear-gradient(180deg,var(--bg1),var(--bg2));
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  text-align:center;
}
.container{
  width:90vw;
  max-width:900px;
  background:rgba(255,255,255,0.08);
  border:5px solid var(--highlight);
  border-radius:20px;
  padding:25px 30px 40px;
  box-shadow:0 0 30px var(--shadow);
}
h1{
  font-size:2.5em;
  color:var(--highlight);
  text-shadow:2px 2px 0 #000;
  margin-bottom:10px;
}
#questionBox{
  font-size:20px;
  color:#fff;
  margin-bottom:15px;
  text-shadow:1px 1px 2px #000;
}
#loading{
  font-size:22px;
  color:var(--highlight);
  animation:blink 1s infinite;
}
@keyframes blink{0%,100%{opacity:1;}50%{opacity:0.4;}}
table{
  width:100%;
  border-collapse:collapse;
  background:#fff;
  color:#05245a;
  border-radius:12px;
  overflow:hidden;
  font-size:18px;
  margin-top:20px;
  opacity:0;
  transform:translateY(20px);
  transition:opacity 0.8s ease,transform 0.8s ease;
}
table.show{opacity:1;transform:translateY(0);}
th,td{border:1px solid #ccc;padding:10px;}
th{background:var(--highlight);color:#05245a;}
tr.gold td{background:#fff6a8;font-weight:700;}
tr.silver td{background:#e0e0e0;font-weight:700;}
tr.bronze td{background:#ffd9b3;font-weight:700;}
button{
  background:var(--highlight);
  color:#05245a;
  border:none;
  border-radius:10px;
  padding:10px 22px;
  font-size:18px;
  font-weight:700;
  cursor:pointer;
  margin:8px;
  opacity:0;
  transform:translateY(10px);
  transition:opacity 0.6s ease,transform 0.6s ease;
}
button.show{opacity:1;transform:translateY(0);}
button:hover{transform:scale(1.05);}
footer{font-size:14px;color:#aaa;margin-top:15px;opacity:0.6;}
</style>
</head>
<body>
<div class="container">
  <h1>üèÜ ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Å‡∏•‡∏∏‡πà‡∏° üèÜ</h1>
  <div id="questionBox">üß† (‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ñ‡∏≤‡∏°‡∏à‡∏∞‡∏õ‡∏£‡∏≤‡∏Å‡∏è‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ)</div>
  <div id="loading">‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div>

  <table id="scoreTable">
    <thead><tr><th>‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö</th><th>‡∏Å‡∏•‡∏∏‡πà‡∏°</th><th>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°</th></tr></thead>
    <tbody id="tbody"></tbody>
  </table>

  <div>
    <button id="backBtn">‚¨ÖÔ∏è ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</button>
    <button id="saveTxtBtn">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å TXT</button>
    <button id="saveSheetBtn">üì§ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Google Sheet</button>
  </div>

  <footer>¬© 2025 TOP25 Quiz System</footer>
  <audio id="finishSound" src="finish.mp3" preload="auto"></audio>
</div>

<script>
const tbody=document.getElementById('tbody');
const loading=document.getElementById('loading');
const scoreTable=document.getElementById('scoreTable');
const backBtn=document.getElementById('backBtn');
const saveTxtBtn=document.getElementById('saveTxtBtn');
const saveSheetBtn=document.getElementById('saveSheetBtn');
const finishSound=document.getElementById('finishSound');
const questionBox=document.getElementById('questionBox');

// üîπ ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏à‡∏≤‡∏Å localStorage
const question = localStorage.getItem('question') || '';
questionBox.textContent = question ? `üß† ${question}` : '‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°';

// üî∏ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏´‡∏ô‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤
const wait = ms => new Promise(res=>setTimeout(res,ms));

async function loadScores(){
  scoreTable.classList.remove('show');
  [backBtn, saveTxtBtn, saveSheetBtn].forEach(b=>{
    b.classList.remove('show');
    b.style.display='none';
  });
  scoreTable.style.display='none';

  await wait(1200); // ‡∏´‡∏ô‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÇ‡∏´‡∏•‡∏î‡∏Å‡πà‡∏≠‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
  const scoreData=JSON.parse(localStorage.getItem('scoreData')||'[]');

  loading.style.display='none';
  scoreTable.style.display='table';

  if(!scoreData.length){
    tbody.innerHTML='<tr><td colspan="3">‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</td></tr>';
  }else{
    tbody.innerHTML='';
    scoreData.forEach((r,i)=>{
      const tr=document.createElement('tr');
      let rankIcon='',rankClass='';
      if(i===0){rankIcon='ü•á';rankClass='gold';}
      else if(i===1){rankIcon='ü•à';rankClass='silver';}
      else if(i===2){rankIcon='ü•â';rankClass='bronze';}
      else{rankIcon=i+1;}
      tr.className=rankClass;
      tr.innerHTML=`<td>${rankIcon}</td><td>‡∏Å‡∏•‡∏∏‡πà‡∏° ${r.group}</td><td>${r.score}</td>`;
      tbody.appendChild(tr);
    });
  }

  await wait(300);
  scoreTable.classList.add('show');
  await wait(300);
  [backBtn, saveTxtBtn, saveSheetBtn].forEach(async(btn,i)=>{
    btn.style.display='inline-block';
    await wait(200*i);
    btn.classList.add('show');
  });

  // üîä ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ï‡∏≠‡∏ô‡πÄ‡∏™‡∏£‡πá‡∏à
  finishSound.currentTime=0;
  finishSound.play();
}

loadScores();

// üîô ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å
backBtn.onclick=()=>{
  if(confirm('‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å‡πÅ‡∏•‡∏∞‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')){
    localStorage.clear();
    location.href='index.html';
  }
};

// üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å TXT
saveTxtBtn.onclick=()=>{
  const scoreData=JSON.parse(localStorage.getItem('scoreData')||'[]');
  const question = localStorage.getItem('question') || '(‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°)';
  if(!scoreData.length){
    alert('‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å');
    return;
  }
  const sorted=[...scoreData].sort((a,b)=>a.group-b.group);
  let text=`üèÜ ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô TOP25 üèÜ\n=========================\n\n‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°: ${question}\n\n`;
  sorted.forEach(r=>{text+=`‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà ${r.group} : ${r.score} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô\n`;});
  const blob=new Blob([text],{type:"text/plain"});
  const a=document.createElement('a');
  a.href=URL.createObjectURL(blob);
  a.download='TOP25_Score.txt';
  a.click();
};

// üì§ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏õ Google Sheet
saveSheetBtn.onclick=async()=>{
  const scoreData = JSON.parse(localStorage.getItem('scoreData') || '[]');
  const selectedSet = parseInt(localStorage.getItem('selectedSet') || '0');
  if(scoreData.length===0){ alert("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô"); return; }

  const gameCol = selectedSet===1 ? "‡πÄ‡∏Å‡∏°‡∏ó‡∏µ‡πà 1" :
                  selectedSet===2 ? "‡πÄ‡∏Å‡∏°‡∏ó‡∏µ‡πà 2" :
                  selectedSet===3 ? "‡πÄ‡∏Å‡∏°‡∏ó‡∏µ‡πà 3" : null;
  if(!gameCol){ alert("‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∏‡∏î‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°"); return; }

  const payload = { sheet:"TOP25", game:gameCol, data:scoreData };

  try{
    const res = await fetch(
      "https://script.google.com/macros/s/AKfycbzypfpqq_tE6OwftL3m1tTOdX6hmXjb7ciaLEz6zgie6MEF3NeBS8NN1eqE1Enp-hYKlw/exec",
      {
        method:"POST",
        body:JSON.stringify(payload),
        headers:{"Content-Type":"application/json"}
      }
    );
    const result = await res.json();
    if(result.status==="success") alert("‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!");
    else alert("‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å");
  }catch(e){
    console.error(e);
    alert("‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Sheet ‡πÑ‡∏î‡πâ");
  }
};
</script>
</body>
</html>
